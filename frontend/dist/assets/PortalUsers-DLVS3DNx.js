import{c as T,r as a,a as j,t as c,j as e,B as n,U as qe,I as d,L as we,D as Ye,e as He,g as Oe,i as B,h as Ce,z as Ae,d as y}from"./index-Og0Cjv7c.js";import{L as f}from"./label-D4adTHT0.js";import{B as Me}from"./badge-0u9PLDS-.js";import{C as Y,a as Se,b as ke,c as te,d as H}from"./card-DKR6wQjg.js";import{T as _e,a as Pe,b as E,c as i,d as Ee,e as l}from"./table-BZ65fvGu.js";import{D as X,a as Z,b as ee,c as se,d as ae,e as be}from"./dialog-CL49OCni.js";import{L as q}from"./loader-circle-qKgIXUvm.js";import{M as re}from"./mail-COINtWyb.js";import{S as Ve}from"./search-C1Z6BGo7.js";import{E as Ke,T as Je,a as Ge}from"./toggle-right-BHKK4ZKU.js";import{K as Te}from"./key-round-BY18d05u.js";import{T as Qe}from"./trash-2-CFn0c5VE.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Xe=T("copy",We);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],es=T("eye-off",Ze);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],as=T("eye",ss);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 8h8",key:"1jbsf9"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M7 16h6",key:"1vyc9m"}]],rs=T("scan-text",ts);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],ls=T("user-plus",ns);function De({credentials:m,onDone:N}){const[h,w]=a.useState(!1),[L,g]=a.useState(!1),[o,C]=a.useState(!1),[O,$]=a.useState(30);a.useEffect(()=>{const r=setTimeout(()=>{w(!1),C(!0)},3e4),b=setInterval(()=>{$(x=>x<=1?(clearInterval(b),0):x-1)},1e3);return()=>{clearTimeout(r),clearInterval(b)}},[]);async function v(){try{await navigator.clipboard.writeText(m.portal_password),g(!0),setTimeout(()=>g(!1),2e3)}catch{const r=document.createElement("textarea");r.value=m.portal_password,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),g(!0),setTimeout(()=>g(!1),2e3)}}const I=m.portal_password.replace(/./g,"â€¢");return e.jsxs(Y,{className:"border-green-200 bg-green-50",children:[e.jsxs(Se,{className:"pb-3",children:[e.jsx(ke,{className:"text-base text-green-800",children:"Customer Created Successfully"}),!o&&e.jsxs(te,{className:"text-green-700",children:["Copy credentials now -- password hidden in ",O,"s"]}),o&&e.jsx(te,{className:"text-muted-foreground",children:"Password display has expired. If you didn't copy it, reset the password."})]}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-lg border border-green-200 bg-white p-4 font-mono text-sm space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"font-medium",children:m.email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Password:"}),e.jsx("span",{className:`font-bold cursor-pointer select-all ${o?"text-muted-foreground":"text-green-800"}`,onClick:()=>!o&&w(r=>!r),title:o?"Expired -- copy was available for 30s":"Click to reveal",children:h&&!o?m.portal_password:I}),!o&&e.jsxs(n,{variant:"outline",size:"sm",className:"h-7 gap-1",onClick:v,children:[L?e.jsx(Ae,{className:"h-3 w-3"}):e.jsx(Xe,{className:"h-3 w-3"}),L?"Copied":"Copy"]}),!o&&e.jsx(n,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>w(r=>!r),children:h?e.jsx(es,{className:"h-3.5 w-3.5"}):e.jsx(as,{className:"h-3.5 w-3.5"})}),o&&e.jsx(Me,{variant:"secondary",className:"text-xs",children:"expired"})]})]}),e.jsx(n,{onClick:N,children:"Done"})]})]})}function os(){return e.jsx(Y,{children:e.jsx(H,{className:"p-0",children:e.jsxs(_e,{children:[e.jsx(Pe,{children:e.jsxs(E,{children:[e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Display Name"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Last Login"}),e.jsx(i,{children:"Created"}),e.jsx(i,{className:"w-[60px]"})]})}),e.jsx(Ee,{children:Array.from({length:5}).map((m,N)=>e.jsxs(E,{children:[e.jsx(l,{children:e.jsx(y,{className:"h-4 w-48"})}),e.jsx(l,{children:e.jsx(y,{className:"h-4 w-32"})}),e.jsx(l,{children:e.jsx(y,{className:"h-5 w-16 rounded-full"})}),e.jsx(l,{children:e.jsx(y,{className:"h-4 w-28"})}),e.jsx(l,{children:e.jsx(y,{className:"h-4 w-24"})}),e.jsx(l,{children:e.jsx(y,{className:"h-8 w-8 rounded-md"})})]},N))})]})})})}function ys(){const[m,N]=a.useState([]),[h,w]=a.useState(""),[L,g]=a.useState(!0),o=localStorage.getItem("admin_role")||"admin",C=o==="admin"||o==="super_admin",[O,$]=a.useState(!1),[v,I]=a.useState(""),[r,b]=a.useState(""),[x,ne]=a.useState(""),[F,le]=a.useState(""),[U,oe]=a.useState(""),[R,ce]=a.useState(""),[A,V]=a.useState(!1),[K,J]=a.useState(null),[ie,de]=a.useState(!1),[Le,D]=a.useState(!1),[me,he]=a.useState(""),[xe,ue]=a.useState(""),[pe,je]=a.useState(""),[G,fe]=a.useState(!1),[u,Q]=a.useState(null),[M,z]=a.useState(null),[W,ge]=a.useState(!1),ve=v&&x?`${v.toLowerCase().replace(/[^a-z]/g,"")}${x.toLowerCase().replace(/[^a-z]/g,"")}@dasherhelp.com`:"",p=a.useCallback(async()=>{try{const s=h?`?search=${encodeURIComponent(h)}`:"",t=await j.get(`/api/portal-users${s}`);N(t.users)}catch(s){c.error(s instanceof Error?s.message:"Failed to load users")}finally{g(!1)}},[h]);async function $e(s){s.preventDefault(),V(!0);try{let t=null;if(R&&F&&U){const k=parseInt(F,10),_=parseInt(U,10),P=parseInt(R,10);if(k<1||k>12||_<1||_>31||P<1900||P>2100){c.error("Invalid date of birth. Month: 1-12, Day: 1-31, Year: 1900-2100"),V(!1);return}t=`${R}-${F.padStart(2,"0")}-${U.padStart(2,"0")}`}const S=await j.post("/api/provision",{first_name:v,middle_name:r||null,last_name:x,date_of_birth:t});J(S),p()}catch(t){c.error(t instanceof Error?t.message:"Provisioning failed")}finally{V(!1)}}function ye(){$(!1),J(null),I(""),b(""),ne(""),le(""),oe(""),ce("")}async function Ie(s){s.preventDefault(),fe(!0);try{await j.post("/api/portal-users",{email:me,password:xe,display_name:pe||null}),he(""),ue(""),je(""),D(!1),c.success("Portal user created"),p()}catch(t){c.error(t instanceof Error?t.message:"Failed to create")}finally{fe(!1)}}async function Fe(s){try{await j.patch(`/api/portal-users/${encodeURIComponent(s.email)}`,{is_active:!s.is_active}),c.success(`${s.email} ${s.is_active?"disabled":"enabled"}`),p()}catch(t){c.error(t instanceof Error?t.message:"Failed to update")}}function Ue(){const s="abcdefghijklmnopqrstuvwxyz",t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",S="0123456789",k=s+t+S,_=[t[Math.floor(Math.random()*t.length)],s[Math.floor(Math.random()*s.length)],S[Math.floor(Math.random()*S.length)]];for(let P=0;P<7;P++)_.push(k[Math.floor(Math.random()*k.length)]);return _.sort(()=>Math.random()-.5).join("")}async function Re(s){try{const t=Ue();await j.patch(`/api/portal-users/${encodeURIComponent(s)}`,{password:t}),Q({email:s,password:t})}catch(t){c.error(t instanceof Error?t.message:"Failed to reset password")}}async function ze(){if(M){ge(!0);try{await j.delete(`/api/portal-users/${encodeURIComponent(M)}`),c.success(`Deleted ${M}`),z(null),p()}catch(s){c.error(s instanceof Error?s.message:"Failed to delete")}finally{ge(!1)}}}async function Be(){de(!0);try{const s=await j.post("/api/dashboard/accounts/extract-names",{});c.success(`Name extraction complete: ${s.updated} updated out of ${s.processed} processed${s.failed>0?`, ${s.failed} failed`:""}`),p()}catch(s){c.error(s instanceof Error?s.message:"Name extraction failed")}finally{de(!1)}}a.useEffect(()=>{p()},[p]);function Ne(s){if(!s)return"--";try{return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return s}}return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Customer Management"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Manage portal users and customer accounts"})]}),e.jsxs("div",{className:"flex gap-2",children:[C&&e.jsxs(n,{variant:"outline",onClick:Be,disabled:ie,children:[ie?e.jsx(q,{className:"h-4 w-4 animate-spin"}):e.jsx(rs,{className:"h-4 w-4"}),"Extract Names"]}),e.jsxs(n,{onClick:()=>{$(!0),D(!1),J(null)},children:[e.jsx(ls,{className:"h-4 w-4"}),"New Customer"]}),C&&e.jsxs(n,{variant:"outline",onClick:()=>D(!0),children:[e.jsx(qe,{className:"h-4 w-4"}),"Manual Create"]})]})]}),O&&!K&&e.jsxs(Y,{children:[e.jsxs(Se,{children:[e.jsx(ke,{className:"text-base",children:"New Customer -- Auto Provision"}),e.jsx(te,{children:"Creates SMTP.dev email account, DB record, and portal login in one step."})]}),e.jsx(H,{children:e.jsxs("form",{onSubmit:$e,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"prov-first",children:"First Name *"}),e.jsx(d,{id:"prov-first",placeholder:"Muhammet",value:v,onChange:s=>I(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"prov-middle",children:"Middle Name"}),e.jsx(d,{id:"prov-middle",placeholder:"Oguz",value:r,onChange:s=>b(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"prov-last",children:"Last Name *"}),e.jsx(d,{id:"prov-last",placeholder:"Bayram",value:x,onChange:s=>ne(s.target.value),required:!0})]})]}),ve&&e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border bg-muted/50 px-4 py-3 text-sm",children:[e.jsx(re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Email:"}),e.jsx("span",{className:"font-semibold",children:ve})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Date of Birth"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{placeholder:"MM",value:F,onChange:s=>le(s.target.value.replace(/\D/g,"").slice(0,2)),maxLength:2,className:"w-16 text-center"}),e.jsx(d,{placeholder:"DD",value:U,onChange:s=>oe(s.target.value.replace(/\D/g,"").slice(0,2)),maxLength:2,className:"w-16 text-center"}),e.jsx(d,{placeholder:"YYYY",value:R,onChange:s=>ce(s.target.value.replace(/\D/g,"").slice(0,4)),maxLength:4,className:"w-20 text-center"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{type:"submit",disabled:A,children:[A&&e.jsx(q,{className:"h-4 w-4 animate-spin"}),A?"Provisioning...":"Create Customer"]}),e.jsx(n,{type:"button",variant:"outline",onClick:ye,children:"Cancel"})]})]})})]}),K&&e.jsx(De,{credentials:K.credentials,onDone:ye}),e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Search customers...",value:h,onChange:s=>w(s.target.value),className:"pl-9"})]}),L?e.jsx(os,{}):e.jsx(Y,{children:e.jsx(H,{className:"p-0",children:e.jsxs(_e,{children:[e.jsx(Pe,{children:e.jsxs(E,{children:[e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Display Name"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Last Login"}),e.jsx(i,{children:"Created"}),e.jsx(i,{className:"w-[60px]"})]})}),e.jsxs(Ee,{children:[m.map(s=>e.jsxs(E,{children:[e.jsx(l,{className:"font-medium",children:e.jsx(we,{to:`/emails/${encodeURIComponent(s.email)}`,className:"hover:underline",children:s.email})}),e.jsx(l,{children:s.display_name||[s.first_name,s.middle_name,s.last_name].filter(Boolean).join(" ")||"--"}),e.jsx(l,{children:e.jsx(Me,{variant:s.is_active?"default":"destructive",className:s.is_active?"bg-green-100 text-green-800 hover:bg-green-100 border-transparent":"",children:s.is_active?"Active":"Disabled"})}),e.jsx(l,{className:"text-muted-foreground",children:Ne(s.last_login_at)}),e.jsx(l,{className:"text-muted-foreground",children:Ne(s.created_at)}),e.jsx(l,{children:e.jsxs(Ye,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(n,{variant:"ghost",size:"icon",className:"h-8 w-8",children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(Oe,{align:"end",children:[e.jsx(B,{asChild:!0,children:e.jsxs(we,{to:`/emails/${encodeURIComponent(s.email)}`,children:[e.jsx(re,{className:"h-4 w-4"}),"View Emails"]})}),C&&e.jsxs(e.Fragment,{children:[e.jsx(Ce,{}),e.jsxs(B,{onClick:()=>Re(s.email),children:[e.jsx(Te,{className:"h-4 w-4"}),"Reset Password"]}),e.jsxs(B,{onClick:()=>Fe(s),children:[s.is_active?e.jsx(Je,{className:"h-4 w-4"}):e.jsx(Ge,{className:"h-4 w-4"}),s.is_active?"Disable":"Enable"]}),e.jsx(Ce,{}),e.jsxs(B,{className:"text-destructive focus:text-destructive",onClick:()=>z(s.email),children:[e.jsx(Qe,{className:"h-4 w-4"}),"Delete"]})]})]})]})})]},s.id)),m.length===0&&e.jsx(E,{children:e.jsx(l,{colSpan:6,className:"h-32 text-center text-muted-foreground",children:"No customers found"})})]})]})})}),e.jsx(X,{open:Le,onOpenChange:D,children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Manual Portal User Create"}),e.jsx(ae,{children:"Create a portal user with custom email and password."})]}),e.jsxs("form",{onSubmit:Ie,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"manual-email",children:"Email *"}),e.jsx(d,{id:"manual-email",type:"email",placeholder:"user@example.com",value:me,onChange:s=>he(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"manual-password",children:"Password *"}),e.jsx(d,{id:"manual-password",type:"password",placeholder:"Password",value:xe,onChange:s=>ue(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"manual-name",children:"Display Name"}),e.jsx(d,{id:"manual-name",type:"text",placeholder:"John Doe",value:pe,onChange:s=>je(s.target.value)})]}),e.jsxs(be,{children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>D(!1),children:"Cancel"}),e.jsxs(n,{type:"submit",disabled:G,children:[G&&e.jsx(q,{className:"h-4 w-4 animate-spin"}),G?"Creating...":"Create"]})]})]})]})}),e.jsx(X,{open:M!==null,onOpenChange:s=>!s&&z(null),children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Delete Portal User"}),e.jsxs(ae,{children:["Are you sure you want to delete"," ",e.jsx("span",{className:"font-semibold",children:M}),"? This action cannot be undone."]})]}),e.jsxs(be,{children:[e.jsx(n,{variant:"outline",onClick:()=>z(null),children:"Cancel"}),e.jsxs(n,{variant:"destructive",onClick:ze,disabled:W,children:[W&&e.jsx(q,{className:"h-4 w-4 animate-spin"}),W?"Deleting...":"Delete"]})]})]})}),e.jsx(X,{open:u!==null,onOpenChange:s=>!s&&Q(null),children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Password Reset Successful"}),e.jsxs(ae,{children:["New credentials for ",e.jsx("span",{className:"font-semibold",children:u==null?void 0:u.email})]})]}),u&&e.jsx(De,{credentials:{email:u.email,portal_password:u.password},onDone:()=>Q(null)})]})})]})}export{ys as default};
