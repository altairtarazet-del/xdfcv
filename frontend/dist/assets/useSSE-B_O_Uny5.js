import{r as c}from"./index-Og0Cjv7c.js";const x="https://api.dasherhelp.com";function T({endpoint:f,token:o,onEvent:e,enabled:d=!0}){const[w,i]=c.useState(!1);c.useRef(null);const u=c.useRef(),p=c.useCallback(()=>{if(!o||!d)return;const l=new AbortController;async function h(){try{const t=await fetch(`${x}${f}`,{headers:{Authorization:`Bearer ${o}`,Accept:"text/event-stream"},signal:l.signal});if(!t.ok||!t.body)throw new Error("SSE connection failed");i(!0);const S=t.body.getReader(),y=new TextDecoder;let n="";for(;;){const{done:A,value:R}=await S.read();if(A)break;n+=y.decode(R,{stream:!0});const m=n.split(`
`);n=m.pop()||"";let r="",a="";for(const s of m)if(s.startsWith("event: "))r=s.slice(7).trim();else if(s.startsWith("data: "))a=s.slice(6).trim();else if(s===""&&r&&a){try{const b=JSON.parse(a);e!=null&&e[r]&&e[r](b),e!=null&&e["*"]&&e["*"](b)}catch{}r="",a=""}}}catch(t){t.name!=="AbortError"&&(i(!1),u.current=setTimeout(h,5e3))}}return h(),()=>{l.abort(),u.current&&clearTimeout(u.current),i(!1)}},[f,o,d]);return c.useEffect(()=>p(),[p]),{connected:w}}export{T as u};
