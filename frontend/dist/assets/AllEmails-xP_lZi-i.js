import{r as a,j as e,U as N,I as G,d as v,a4 as y,L as P,a as c}from"./index-Og0Cjv7c.js";import{a as Q,b as T}from"./index-CtgARJQr.js";import{S as D,E as V}from"./EmailPanel-eEQInLYz.js";import{C as q}from"./card-DKR6wQjg.js";import{B as z}from"./badge-0u9PLDS-.js";import{S as F}from"./search-C1Z6BGo7.js";import"./index-BdQq_4o_.js";import"./triangle-alert-BALBCSHX.js";import"./trash-2-CFn0c5VE.js";import"./mail-COINtWyb.js";import"./loader-circle-qKgIXUvm.js";function ae(){const[i,h]=a.useState([]),[l,w]=a.useState(null),[r,S]=a.useState(""),[C,m]=a.useState([]),[o,x]=a.useState(null),[A,u]=a.useState([]),[M,d]=a.useState(null),[E,f]=a.useState(!1),[$,p]=a.useState(!1),[L,b]=a.useState(""),[U,g]=a.useState(!0);async function _(){g(!0);try{const s=await c.get("/api/dashboard/accounts?per_page=200");h(s.accounts)}catch{h([])}finally{g(!1)}}async function I(s){w(s),m([]),u([]),d(null),x(null),b("");try{const t=await c.get(`/api/admin/customer-emails/${encodeURIComponent(s)}/mailboxes`);if(m(t.mailboxes),t.mailboxes.length>0){const n=t.mailboxes.find(R=>R.name.toLowerCase()==="inbox")||t.mailboxes[0];x(n.id)}}catch{m([])}}async function k(s){if(l){f(!0),d(null);try{const t=await c.get(`/api/admin/customer-emails/${encodeURIComponent(l)}/mailboxes/${s}/messages?per_page=100`);u(t.data||[])}catch{u([])}finally{f(!1)}}}async function B(s){if(!(!l||!o)){p(!0);try{const t=await c.get(`/api/admin/customer-emails/${encodeURIComponent(l)}/mailboxes/${o}/messages/${s}`);d(t)}catch{d(null)}finally{p(!1)}}}a.useEffect(()=>{_()},[]),a.useEffect(()=>{o&&k(o)},[o]);const j=r?i.filter(s=>s.email.toLowerCase().includes(r.toLowerCase())||(s.customer_name||"").toLowerCase().includes(r.toLowerCase())):i;return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-dd-200 bg-white flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5 text-dd-600"}),e.jsx("h1",{className:"text-xl font-bold text-dd-950",children:"All Emails"})]}),e.jsxs("p",{className:"text-sm text-dd-600 mt-0.5",children:[i.length," customer accounts"]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-72 bg-white border-r border-dd-200 flex-shrink-0 flex flex-col",children:[e.jsx("div",{className:"px-3 py-3 border-b border-dd-200",children:e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-dd-500"}),e.jsx(G,{type:"text",placeholder:"Search customer...",value:r,onChange:s=>S(s.target.value),className:"pl-9 h-9 bg-dd-100 border-transparent focus-visible:ring-dd-red/20 focus-visible:border-dd-red/30 text-sm"})]})}),e.jsx(D,{className:"flex-1",children:U?e.jsx("div",{className:"p-3 space-y-2",children:Array.from({length:8}).map((s,t)=>e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx(v,{className:"h-4 w-3/4"}),e.jsx(v,{className:"h-3 w-1/2"})]},t))}):j.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(N,{className:"h-8 w-8 text-dd-300 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-dd-500",children:"No accounts found"})]}):j.map(s=>{const t=l===s.email,n=Q[s.stage];return e.jsx(q,{onClick:()=>I(s.email),className:`cursor-pointer rounded-none border-x-0 border-t-0 border-b border-dd-200 shadow-none transition-colors ${t?"bg-dd-red-light border-l-[3px] border-l-dd-red pl-[13px]":"hover:bg-dd-50"}`,children:e.jsx("div",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center gap-2.5",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:`text-sm truncate ${t?"text-dd-red font-semibold":"text-dd-950 font-medium"}`,children:s.email.split("@")[0]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1",children:[e.jsx(z,{variant:"secondary",className:`text-[10px] px-1.5 py-0 font-medium border-0 ${T[s.stage]||"bg-dd-200 text-dd-700"}`,children:(n==null?void 0:n.label)||s.stage}),s.customer_name&&e.jsx("span",{className:"text-[11px] text-dd-600 truncate",children:s.customer_name})]})]})})})},s.id)})})]}),l?e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2.5 bg-dd-50 border-b border-dd-200 flex-shrink-0 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4 text-dd-600"}),e.jsx("span",{className:"text-sm font-medium text-dd-950",children:l})]}),e.jsx(P,{to:`/accounts/${encodeURIComponent(l)}`,className:"text-xs font-medium text-dd-red hover:text-dd-red-hover transition-colors",children:"View Account â†’"})]}),e.jsx(V,{mailboxes:C,activeMailbox:o,onSelectMailbox:x,messages:A,loadingMsgs:E,activeMessage:M,loadingBody:$,onSelectMessage:B,searchQuery:L,onSearchChange:b,onClearMessage:()=>d(null),attachmentBaseUrl:l?`/api/admin/customer-emails/${encodeURIComponent(l)}`:void 0})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center bg-dd-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"w-16 h-16 text-dd-300 mx-auto mb-4"}),e.jsx("p",{className:"text-dd-600 font-medium",children:"Select a customer"}),e.jsx("p",{className:"text-sm text-dd-500 mt-1",children:"Choose an account from the left to view their emails"})]})})]})]})}export{ae as default};
